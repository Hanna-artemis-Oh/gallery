<!DOCTYPE html>
{%load static%}
{% include 'shared/_hp.html' %}
<html lang="ko">
  <head>
    <meta charset="UTF-8">
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <title>Gallery</title>
  </head>
  <body>
    <div>
      <h2>결과 페이지 입니다.</h2>
    </div>
    <img src="{{ img_file.fileurl }}" alt="image" style="width: 600px;">
    <div>
      <strong>텍스트 내용: </strong>
      <p>{{text}}</p>
      <p>{{tags}}</p>
      <p>{{music_file}}</p>

      <midi-player src="{{ music_file.fileurl }}" sound-font/>
    </div>

    <div>
      <h2>어떤 결과가 마음에 드시나요?</h2>
        <p><button id="result_favorite" value="jpg">그림이 마음에 들어요</button></p>
        <p><button id="result_favorite" value="mid">음악이 마음에 들어요</button></p>
        <br>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="text/javascript">

      // 조건문 없이 모든 요청에 대해 timeout 일괄 적용
      const instanace = axios.create({
        headers: {
          timeout: 1000
        },
      })
      var count = 0
      var cols = document.querySelectorAll('#result_favorite'); 
      [].forEach.call(cols, function(col){ 
        col.addEventListener("click", click, false); 
      }); 
      function click(e){ 
        e.target.setAttribute("disabled",true);
        count += 1;
        document.getElementById('favorite').value = e.target.value;
        if (count >= 2) {
          document.getElementById('favorite').value = 'both';
        }
        console.log( document.getElementById('favorite').value );
      }

      function goto_login() {
        let text = "로그인하셔야 이용할 수 있습니다.\n로그인 하시겠습니까?";
        if (confirm(text) == true) {
          location.href = "{% url 'login' %}?next=/result/";
        } else {
          text = "You canceled!";
        }

      }
    </script>

    <div>
    <form method="post" action="{% url 'salon:save_result' %}">
      <input type="hidden" id="favorite" name="favorite" value="0">
      <input type="hidden" id="input_text" name="input_text" value="{{ text }}">
      <input type="checkbox" id="selected" name="selected" value="image" onclick="toggleVisibility(this)">그림</checkbox>
      <input type="checkbox" id="selected" name="selected" value="music" onclick="toggleVisibility(this)">음악</checkbox>
    {% if user.is_authenticated %} 
      <p><button id="save_button" disabled=true>마이페이지에 저장하기</button></p>
    </form>
    {% else %}
    </form>
      <p><button id="save_button" onclick="goto_login()" disabled=true>마이페이지에 저장하기</button></p>
    {% endif %}
      <br>
    </div>

  <script type="text/javascript" src="{% static 'salon/js/checkbox.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.22.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.4.0"></script>
  </body>
</html>
    