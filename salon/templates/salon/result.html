{%load static%}
{% csrf_token %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Gallery</title>
  </head>
  {% include 'shared/_hp.html' %}
  <body>
    <div>
      <button value="mypage"><a type='button' href="{% url 'mypage:mypage' user.username %}" class='mypage'>My Page</a></button>
      <button value="home"><a type='button' href="{% url 'salon:index' %}" class='index'>HOME</a></button>
    </div>
    <div>
      <h2>결과 페이지 입니다.</h2>
    </div>
    <img src="{{img_file}}" alt="image">
    <img src="{{img_tn_file}}" alt="thumbnail">
    <div>
      <strong>텍스트 내용: </strong>
      <p>{{text}}</p>
      <p>{{tags}}</p>
      <p>{{music_file}}</p>

      <midi-player src="{{music_file}}" sound-font/>
    </div>

    <div>
      <h2>어떤 결과가 마음에 드시나요?</h2>
        <p><button id="result_favorite" value="jpg">그림이 마음에 들어요</button></p>
        <p><button id="result_favorite" value="mid">음악이 마음에 들어요</button></p>
        <br>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.js"></script>
    <!-- <script type="text/javascript" src="{% static 'salon/js/accessOnce.js' %}"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="text/javascript">

      // 조건문 없이 모든 요청에 대해 timeout 일괄 적용
      const instanace = axios.create({
        headers: {
          timeout: 1000
        },
      })
      var count = 0
      var cols = document.querySelectorAll('#result_favorite'); 
      [].forEach.call(cols, function(col){ 
        col.addEventListener("click", click, false); 
      }); 
      function click(e){ 
        
        // var select_value = e.target.value

        // axios.post("/result_favorite/", {aa: select_value})
        // .then(function (res) {return res.data} )
        // .then(function (data) { console.log(data) } )
        // .catch(function (error) {console.log(error)} )
        e.target.setAttribute("disabled",true);
        count += 1;
        document.getElementById('favorite').value = e.target.value;
        if (count >= 2) {
          document.getElementById('favorite').value = 'both';
        }
        console.log( document.getElementById('favorite').value );
      }
    </script>

    <div>
    <form method="post" action="{% url 'salon:save_result' %}">
      <input type="hidden" id="favorite" name="favorite" value="0">
      <input type="hidden" id="input_text" name="input_text" value="{{text}}">
      <input type="checkbox" id="selected" name="selected" value="{{img_file}}" onclick="toggleVisibility(this)">이미지저장DB에기록</checkbox>
      <input type="checkbox" id="selected" name="selected" value="{{music_file}}" onclick="toggleVisibility(this)">음악저장DB에기록</checkbox>
      <p><button id="save_button" disabled=true>저장하기</button></p>
    </form>
      <br>
    </div>

  <script type="text/javascript" src="{% static 'salon/js/checkbox.js' %}"></script>
  </body>
  <script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.22.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.4.0"></script>
</html>
