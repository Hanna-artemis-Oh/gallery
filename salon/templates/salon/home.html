{% load static %}
{% include 'shared/_hp.html' %}
<link rel="stylesheet" href="{% static 'salon/css/style.css' %}">

    <div class="grid-container">
      <p class="start-area"><a href="{% url 'salon:start' %}">작품 생성하러 가기</a></p>
    </div>
      
    <main class="grid-item main">
      <p class="keyword-area">{{ key }}</p>
      <div class="items">
        {% for img in images %}   
        <div class="btn-open-popup item item{{forloop.counter}}">
          <img class="sample-img" src="{{ img.thumbnailurl }}" alt="thumbnail">
          <img class="test ori-img" src="{{ img.fileurl }}" alt="filename" style="width: 500px; display: none;">
          <p class="test input-text" style="display: none;">{{ img.input_text }}</p>
          <p class="test img-user" style="display: none;">created by... <a href="{% url 'mypage:mypage' img.user %}" style="display: inline;">@{{ img.user }}</a></p>
        </div>
        {% endfor %}
      </div>

      <div class="items">
        {% for mus in musics %}
        <div class="item item-music">
          <p class="mus-url" style="display: none;">{{ mus.fileurl }}</p>
          <p>Click to Listen!<br><strong>{{ mus.input_text }}</strong></p>
          <midi-player id="myAudio" src="{{ mus.fileurl }}" sound-font style="display: none;"/>
        </div>
        {% endfor %}
      </div>
      <hr>
      
    </main> 
    <div class="modal">
      <div class="modal-body fade">
        <div class="modal-close">
          <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="black"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </div>
        <div class="modal-items">
          <div class="modal-img"></div>
          <div class="modal-text"></div>
        </div>
      </div>
    </div>
  
  <script src="{% static 'salon/js/modal.js' %}"></script>
  <script src="{% static 'salon/js/scroll.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.23.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.5.0"></script>
  <script>
    
    const musicItemList = document.querySelectorAll(".item-music");
    let isPlaying = false;

    musicItemList.forEach(musicItem =>
      musicItem.addEventListener('click', (e) => {
        var myAudio = e.currentTarget.querySelector('#myAudio')
        console.log(myAudio);
        if (isPlaying) {
          myAudio.stop();
          isPlaying = false;
        } else {
          myAudio.start();
          isPlaying = true;
        }
      })
    );
    
  
  </script>
